@page "/signup"
@inject HttpClient Http
@inject IJSRuntime JS

<MudContainer MaxWidth="MaxWidth.Small">
    <MudText Typo="Typo.h4" Class="mb-4">Admin Signup</MudText>

    <MudTextField @bind-Value="Username" Label="Username" Required="true" />
    <MudTextField @bind-Value="Email" Label="Email" Required="true" />
    <MudTextField @bind-Value="Password" Label="Password" InputType="InputType.Password" Required="true" />

    <MudButton OnClick="SubmitSignup" Variant="Variant.Filled" Color="Color.Primary" Class="mt-3">Sign Up</MudButton>
</MudContainer>

@code {
    private string Username { get; set; }
    private string Email { get; set; }
    private string Password { get; set; }

    private async Task SubmitSignup()
    {
        var newUser = new
        {
            Username,
            PasswordHash = Password, // The API will handle hashing
            Email
        };

        var response = await Http.PostAsJsonAsync("https://localhost:7043/Auth/signup", newUser);

        if (response.IsSuccessStatusCode)
        {
            await JS.InvokeVoidAsync("Swal.fire", new
            {
                title = "Success!",
                text = "User registered successfully.",
                icon = "success"
            });
        }
        else
        {
            var error = await response.Content.ReadAsStringAsync();
            await JS.InvokeVoidAsync("Swal.fire", new
            {
                title = "Error",
                text = error,
                icon = "error"
            });
        }
    }
}
