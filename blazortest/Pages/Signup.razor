@page "/signup"
@inject HttpClient Http
@inject IJSRuntime JS
@inject NavigationManager Navigation

<MudContainer Class="signup-container">
    <MudCard>
        <MudCardHeader>
            <MudText Typo="Typo.h4" Class="text-center">Admin Signup</MudText>
        </MudCardHeader>

        <MudCardContent>
            <MudTextField Label="Username" @bind-Value="username" Required="true" />
            <MudTextField Label="Password" @bind-Value="password" InputType="InputType.Password" Required="true" />
        </MudCardContent>

        <MudCardActions Class="justify-end">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SignupUser">Signup</MudButton>
        </MudCardActions>
    </MudCard>
</MudContainer>

@code {
    private string username = "";
    private string password = "";

    private async Task SignupUser()
    {
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            await JS.InvokeVoidAsync("Swal.fire", new
            {
                title = "Error",
                text = "Please fill in all fields.",
                icon = "error"
            });
            return;
        }

        var signupData = new
        {
            Username = username,
            PasswordHash = password
        };

        var response = await Http.PostAsJsonAsync("https://localhost:7043/api/auth/signup", signupData);

        if (response.IsSuccessStatusCode)
        {
            await JS.InvokeVoidAsync("Swal.fire", new
            {
                title = "Success!",
                text = "Signup successful.",
                icon = "success"
            });

            Navigation.NavigateTo("/login", forceLoad: true);
        }
        else
        {
            string errorMessage = await response.Content.ReadAsStringAsync();
            await JS.InvokeVoidAsync("Swal.fire", new
            {
                title = "Signup Failed",
                text = errorMessage,
                icon = "error"
            });
        }
    }
}
